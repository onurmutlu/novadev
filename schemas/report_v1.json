{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://novadev.local/schemas/report_v1.json",
  "title": "Wallet Activity Report v1",
  "description": "24-hour (or N-hour) wallet activity summary from on-chain transfers",
  "type": "object",
  
  "required": [
    "version", "wallet", "window_hours", "time", 
    "totals", "tx_count", "transfer_stats", 
    "top_counterparties", "meta"
  ],
  
  "properties": {
    "version": {
      "const": "v1",
      "description": "Schema version (immutable for v1 reports)"
    },
    
    "wallet": {
      "type": "string",
      "pattern": "^0x[a-fA-F0-9]{40}$",
      "description": "Target wallet address (checksummed optional)"
    },
    
    "window_hours": {
      "type": "integer",
      "minimum": 1,
      "maximum": 720,
      "description": "Report time window (1 hour to 30 days)"
    },
    
    "time": {
      "type": "object",
      "description": "UTC time range for report",
      "required": ["from_ts", "to_ts"],
      "properties": {
        "from_ts": {
          "type": "string",
          "format": "date-time",
          "description": "Start time (inclusive, ISO8601 UTC)"
        },
        "to_ts": {
          "type": "string",
          "format": "date-time",
          "description": "End time (exclusive, ISO8601 UTC)"
        }
      },
      "additionalProperties": false
    },
    
    "totals": {
      "type": "object",
      "description": "Aggregate inbound/outbound across all tokens",
      "required": ["inbound", "outbound"],
      "properties": {
        "inbound": {
          "type": "number",
          "minimum": 0,
          "description": "Total value received (human-readable units)"
        },
        "outbound": {
          "type": "number",
          "minimum": 0,
          "description": "Total value sent (human-readable units)"
        },
        "net": {
          "type": "number",
          "description": "Optional: inbound - outbound"
        }
      },
      "additionalProperties": false
    },
    
    "tx_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Distinct transaction count involving wallet"
    },
    
    "transfer_stats": {
      "type": "array",
      "description": "Per-token breakdown",
      "items": {
        "type": "object",
        "required": ["token", "symbol", "decimals", "inbound", "outbound", "tx_count"],
        "properties": {
          "token": {
            "type": "string",
            "pattern": "^0x[a-fA-F0-9]{40}$",
            "description": "Token contract address"
          },
          "symbol": {
            "type": "string",
            "minLength": 1,
            "maxLength": 16,
            "description": "Token symbol (e.g. USDC, DAI)"
          },
          "decimals": {
            "type": "integer",
            "minimum": 0,
            "maximum": 36,
            "description": "Token decimals (0-36)"
          },
          "inbound": {
            "type": "number",
            "minimum": 0,
            "description": "Received amount (human-readable)"
          },
          "outbound": {
            "type": "number",
            "minimum": 0,
            "description": "Sent amount (human-readable)"
          },
          "tx_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of transfers for this token"
          }
        },
        "additionalProperties": false
      }
    },
    
    "top_counterparties": {
      "type": "array",
      "description": "Most frequent interacting addresses",
      "maxItems": 20,
      "items": {
        "type": "object",
        "required": ["address", "count"],
        "properties": {
          "address": {
            "type": "string",
            "pattern": "^0x[a-fA-F0-9]{40}$",
            "description": "Counterparty address"
          },
          "count": {
            "type": "integer",
            "minimum": 1,
            "description": "Interaction count"
          },
          "label": {
            "type": "string",
            "maxLength": 64,
            "description": "Optional: Known label (e.g. 'Uniswap Router')"
          }
        },
        "additionalProperties": false
      }
    },
    
    "meta": {
      "type": "object",
      "description": "Report metadata",
      "required": ["chain_id", "generated_at", "source"],
      "properties": {
        "chain_id": {
          "type": "integer",
          "description": "EVM chain ID (e.g. 11155111 for Sepolia)"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Report generation timestamp (UTC)"
        },
        "source": {
          "type": "string",
          "description": "Data source identifier"
        },
        "notes": {
          "type": "string",
          "maxLength": 256,
          "description": "Optional notes or warnings"
        }
      },
      "additionalProperties": false
    }
  },
  
  "additionalProperties": false
}
